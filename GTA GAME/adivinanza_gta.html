<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Adivinanza GTA - Floogy's Games</title>
<style>
  :root{
    --bg:#0f0f10; --card:#171717; --accent:#00aaff;
    --red:#b71c1c; --yellow:#f1c40f; --green:#2ecc71;
    --cell:#222;
  }

  body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:#fff;text-align:center;}
  .home-btn-wrap{position:fixed;top:10px;left:10px;z-index:999999}
  .home-btn{background:#000;padding:10px 14px;border-radius:10px;color:#fff;font-weight:700;text-decoration:none}
  header{padding-top:70px}
  h1{margin:0;font-size:28px}
  .container{max-width:980px;margin:20px auto;padding:20px}
  .stats-row{display:flex;gap:12px;justify-content:center;align-items:center;margin-bottom:12px;flex-wrap:wrap}
  .stats-box{background:#111;padding:10px;border-radius:10px;display:inline-block;font-size:16px;font-weight:700}
  .lives{color:#ff4747}
  .streak{color:#ffae00;text-shadow:0 0 8px #ffae00}
  .controls{display:flex;gap:12px;justify-content:center;margin:14px 0;flex-wrap:wrap}
  input[type="text"]{padding:10px;background:#222;color:#fff;border-radius:8px;border:0;width:420px;font-size:16px}
  .btn{padding:10px 14px;border-radius:8px;border:0;background:var(--accent);color:#000;font-weight:700;cursor:pointer}
  #grid{display:grid;grid-template-columns:repeat(6,1fr);gap:8px;max-width:980px;margin:12px auto}
  .col-header{background:#111;padding:8px;border-radius:6px;font-weight:700;font-size:14px}
  .row{display:grid;grid-template-columns:repeat(6,1fr);gap:8px;margin-top:6px}
  .cell{background:var(--cell);padding:12px;border-radius:6px;min-height:48px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px}
  .green{background:var(--green);color:#000}
  .yellow{background:var(--yellow);color:#000}
  .red{background:var(--red);color:#fff}
  .overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);display:flex;align-items:center;justify-content:center;z-index:9999999}
  .overlay-box{background:#111;padding:30px 36px;border-radius:14px;border:3px solid #fff;max-width:90%;text-align:center;font-size:20px}
  .play-again{margin-top:16px;padding:10px 14px;border-radius:8px;background:var(--accent);color:#000;border:0;cursor:pointer;font-weight:800}
  .suggestions-list{position:absolute;left:0;top:40px;background:#222;border:1px solid #333;width:420px;border-radius:6px;max-height:240px;overflow:auto;display:none;z-index:200}
  .suggestions-list div{padding:8px;cursor:pointer}
  .suggestions-list div:hover{background:#444}
  .meta{color:#aaa;font-size:13px;margin-top:8px}
  .attempts{max-width:980px;margin:12px auto;text-align:left;color:#ddd}
  .name-header{font-weight:800;margin-top:8px;margin-bottom:4px}
  @keyframes fadeIn{from{opacity:0}to{opacity:1}}
</style>
</head>
<body>

<div class="home-btn-wrap"><a class="home-btn" href="floogys_games_index.html">Floogy¬¥s Games</a></div>

<header><h1>ADIVINANZA GTA</h1></header>

<div class="container">

  <div class="stats-row">
    <div id="livesBox" class="stats-box">‚ù§Ô∏è Vidas: <span id="lives" class="lives">7</span></div>
    <div id="streakBox" class="stats-box">üî• Racha: <span id="streak" class="streak">0</span></div>
    <div id="bestBox" class="stats-box">üèÜ Mejor: <span id="best" class="streak">0</span></div>
  </div>

  <div class="controls">
    <div style="position:relative">
      <input id="guessInput" type="text" placeholder="Escribe un personaje de GTA..." autocomplete="off" />
      <div id="suggestions" class="suggestions-list"></div>
    </div>
    <button id="guessBtn" class="btn">ADIVINAR</button>
    <button id="hintBtn" class="btn" style="background:#555;color:#fff">PISTA</button>
  </div>

  <div class="included-games" style="color:#ddd;font-size:14px;margin-top:12px;margin-bottom:12px">
    <b>Juegos incluidos en esta adivinanza:</b><br>
    GTA 1, GTA 2, GTA III, GTA Vice City, GTA San Andreas,<br>
    GTA Liberty City Stories, GTA Vice City Stories,<br>
    GTA IV, The Lost and Damned, The Ballad of Gay Tony,<br>
    GTA V (incluye secundarios/online relevantes).
  </div>

  <div class="meta">Colores: <span style="color:var(--green)">Verde</span>=exacto, <span style="color:var(--yellow)">Amarillo</span>=mismo grupo/era, <span style="color:var(--red)">Rojo</span>=sin relaci√≥n. La columna <strong>A√±o</strong> muestra adem√°s ‚Üë/‚Üì.</div>

  <div id="grid">
    <div class="col-header">Juego debut</div>
    <div class="col-header">Ciudad</div>
    <div class="col-header">Afiliaci√≥n</div>
    <div class="col-header">Rol</div>
    <div class="col-header">A√±o</div>
    <div class="col-header">Saga</div>
  </div>

  <div id="attemptsArea" class="attempts"></div>
</div>

<script>
/* ===== Base de personajes (opci√≥n 1: personajes importantes) =====
   Lista limpia, sin duplicados. Puedes ampliarla m√°s tarde.
*/
const characters = [
  // CLASSIC / 2D-era (placeholders for main entries)
  {key:"player1", name:"Player 1", game:"GTA 1", city:"Anywhere", affiliation:"Independent", affiliationGroup:"independent", role:"protagonist", roleGroup:"protagonist", year:1997, saga:"classic"},
  {key:"player2", name:"Player 2", game:"GTA 2", city:"Anywhere", affiliation:"Independent", affiliationGroup:"independent", role:"protagonist", roleGroup:"protagonist", year:1999, saga:"classic"},

  // SAN ANDREAS (principales)
  {key:"cj", name:"Carl Johnson", game:"San Andreas", city:"Los Santos", affiliation:"Grove Street Families", affiliationGroup:"gang", role:"protagonist", roleGroup:"protagonist", year:2004, saga:"SA-era"},
  {key:"maddogg", name:"Madd Dogg", game:"San Andreas", city:"Los Santos", affiliation:"Independent", affiliationGroup:"independent", role:"secondary", roleGroup:"secondary", year:2004, saga:"SA-era"},
  {key:"sweet", name:"Sean 'Sweet' Johnson", game:"San Andreas", city:"Los Santos", affiliation:"Grove Street Families", affiliationGroup:"gang", role:"secondary", roleGroup:"secondary", year:2004, saga:"SA-era"},
  {key:"ryder", name:"Lance 'Ryder' Wilson", game:"San Andreas", city:"Los Santos", affiliation:"Grove Street Families", affiliationGroup:"gang", role:"secondary", roleGroup:"secondary", year:2004, saga:"SA-era"},
  {key:"tenpenny", name:"Officer Tenpenny", game:"San Andreas", city:"Los Santos", affiliation:"Police", affiliationGroup:"government", role:"antagonist", roleGroup:"antagonist", year:2004, saga:"SA-era"},

  // VICE CITY
  {key:"tommy", name:"Tommy Vercetti", game:"Vice City", city:"Vice City", affiliation:"Independent", affiliationGroup:"independent", role:"protagonist", roleGroup:"protagonist", year:2002, saga:"3D-era"},
  {key:"lancev", name:"Lance Vance", game:"Vice City", city:"Vice City", affiliation:"Vance Crime Family", affiliationGroup:"mafia", role:"secondary", roleGroup:"secondary", year:2002, saga:"3D-era"},
  {key:"ken", name:"Ken Rosenberg", game:"Vice City", city:"Vice City", affiliation:"Independent", affiliationGroup:"independent", role:"secondary", roleGroup:"secondary", year:2002, saga:"3D-era"},

  // GTA III / LIBERTY CITY
  {key:"claude", name:"Claude", game:"GTA III", city:"Liberty City", affiliation:"Independent", affiliationGroup:"independent", role:"protagonist", roleGroup:"protagonist", year:2001, saga:"3D-era"},
  {key:"sal", name:"Salvatore Leone", game:"GTA III", city:"Liberty City", affiliation:"Leone Family", affiliationGroup:"mafia", role:"secondary", roleGroup:"secondary", year:2001, saga:"3D-era"},
  {key:"rosa", name:"Rosa", game:"GTA III", city:"Liberty City", affiliation:"Family", affiliationGroup:"mafia", role:"secondary", roleGroup:"secondary", year:2001, saga:"3D-era"},

  // GTA IV + expansions
  {key:"niko", name:"Niko Bellic", game:"GTA IV", city:"Liberty City", affiliation:"Independent", affiliationGroup:"independent", role:"protagonist", roleGroup:"protagonist", year:2008, saga:"IV-era"},
  {key:"roman", name:"Roman Bellic", game:"GTA IV", city:"Liberty City", affiliation:"Independent", affiliationGroup:"independent", role:"secondary", roleGroup:"secondary", year:2008, saga:"IV-era"},
  {key:"brucie", name:"Brucie Kibbutz", game:"GTA IV", city:"Liberty City", affiliation:"Independent", affiliationGroup:"independent", role:"secondary", roleGroup:"secondary", year:2008, saga:"IV-era"},
  {key:"packie", name:"Patrick McReary", game:"GTA IV", city:"Liberty City", affiliation:"McReary family", affiliationGroup:"mafia", role:"secondary", roleGroup:"secondary", year:2008, saga:"IV-era"},
  {key:"dimitri", name:"Dimitri Rascalov", game:"GTA IV", city:"Liberty City", affiliation:"Organized Crime", affiliationGroup:"mafia", role:"antagonist", roleGroup:"antagonist", year:2008, saga:"IV-era"},
  {key:"tonypr", name:"Tony Prince", game:"TBoGT", city:"Liberty City", affiliation:"Gay Tony", affiliationGroup:"mafia", role:"secondary", roleGroup:"secondary", year:2009, saga:"IV-era"},

  // GTA V principales y secundarios
  {key:"michael", name:"Michael De Santa", game:"GTA V", city:"Los Santos", affiliation:"Independent", affiliationGroup:"independent", role:"protagonist", roleGroup:"protagonist", year:2013, saga:"V-era"},
  {key:"franklin", name:"Franklin Clinton", game:"GTA V", city:"Los Santos", affiliation:"Independent", affiliationGroup:"independent", role:"protagonist", roleGroup:"protagonist", year:2013, saga:"V-era"},
  {key:"trevor", name:"Trevor Philips", game:"GTA V", city:"Sandy Shores", affiliation:"Independent", affiliationGroup:"independent", role:"protagonist", roleGroup:"protagonist", year:2013, saga:"V-era"},
  {key:"lester", name:"Lester Crest", game:"GTA V", city:"Los Santos", affiliation:"Independent/Criminal", affiliationGroup:"independent", role:"secondary", roleGroup:"secondary", year:2013, saga:"V-era"},
  {key:"lamar", name:"Lamar Davis", game:"GTA V", city:"Los Santos", affiliation:"Independent/Gang Adjacent", affiliationGroup:"gang", role:"secondary", roleGroup:"secondary", year:2013, saga:"V-era"},
  {key:"simeon", name:"Simeon Yetarian", game:"GTA V", city:"Los Santos", affiliation:"Auto Dealer", affiliationGroup:"other", role:"secondary", roleGroup:"secondary", year:2013, saga:"V-era"},
  {key:"devin", name:"Devin Weston", game:"GTA V", city:"Los Santos", affiliation:"Corporate", affiliationGroup:"other", role:"antagonist", roleGroup:"antagonist", year:2013, saga:"V-era"},
  {key:"martinm", name:"Martin Madrazo", game:"GTA V", city:"Los Santos", affiliation:"Crime/Cartel", affiliationGroup:"mafia", role:"secondary", roleGroup:"secondary", year:2013, saga:"V-era"},
  {key:"wei", name:"Wei Cheng", game:"GTA V", city:"Los Santos", affiliation:"Gang/Chinese", affiliationGroup:"gang", role:"antagonist", roleGroup:"antagonist", year:2013, saga:"V-era"},
  {key:"steveh", name:"Steve Haines", game:"GTA V", city:"Los Santos", affiliation:"Government", affiliationGroup:"government", role:"antagonist", roleGroup:"antagonist", year:2013, saga:"V-era"},

  // Spinoffs and important characters
  {key:"paulie", name:"Paulie", game:"Liberty City Stories", city:"Liberty City", affiliation:"Cosa Nostra", affiliationGroup:"mafia", role:"secondary", roleGroup:"secondary", year:2005, saga:"3D-era"},
  {key:"toni", name:"Toni Cipriani", game:"Liberty City Stories", city:"Liberty City", affiliation:"Cosa Nostra", affiliationGroup:"mafia", role:"protagonist", roleGroup:"protagonist", year:2005, saga:"3D-era"},
  {key:"luisl", name:"Luis Lopez", game:"The Ballad of Gay Tony", city:"Liberty City", affiliation:"Gay Tony", affiliationGroup:"mafia", role:"protagonist", roleGroup:"protagonist", year:2009, saga:"IV-era"},
  {key:"johnnyk", name:"Johnny Klebitz", game:"The Lost and Damned", city:"Liberty City", affiliation:"The Lost MC", affiliationGroup:"gang", role:"protagonist", roleGroup:"protagonist", year:2009, saga:"IV-era"},
  {key:"jasonv", name:"Jason", game:"Vice City Stories", city:"Vice City", affiliation:"Vance Family", affiliationGroup:"mafia", role:"secondary", roleGroup:"secondary", year:2006, saga:"3D-era"},

  // Other notable NPCs
  {key:"ogloc", name:"OG Loc", game:"San Andreas", city:"Los Santos", affiliation:"Independent", affiliationGroup:"independent", role:"secondary", roleGroup:"secondary", year:2004, saga:"SA-era"},
  {key:"rufus", name:"Rufus", game:"GTA 2", city:"Anywhere", affiliation:"Independent", affiliationGroup:"independent", role:"secondary", roleGroup:"secondary", year:1999, saga:"classic"},
  {key:"zed", name:"Zed", game:"GTA III", city:"Liberty City", affiliation:"Independent", affiliationGroup:"independent", role:"secondary", roleGroup:"secondary", year:2001, saga:"3D-era"},
  {key:"maria", name:"Maria Latore", game:"GTA III", city:"Liberty City", affiliation:"Family/Mafia", affiliationGroup:"mafia", role:"secondary", roleGroup:"secondary", year:2001, saga:"3D-era"},
  {key:"vlad", name:"Vlad Glebov", game:"GTA IV", city:"Liberty City", affiliation:"Independent", affiliationGroup:"independent", role:"antagonist", roleGroup:"antagonist", year:2008, saga:"IV-era"},
  {key:"billyg", name:"Billy Grey", game:"The Lost and Damned", city:"Liberty City", affiliation:"The Lost MC", affiliationGroup:"gang", role:"antagonist", roleGroup:"antagonist", year:2009, saga:"IV-era"}
];

// storage keys
const STREAK_KEY = "gta_adivinanza_streak";
const BEST_KEY = "gta_adivinanza_best";

let lives = 7;
let streak = parseInt(localStorage.getItem(STREAK_KEY)) || 0;
let best = parseInt(localStorage.getItem(BEST_KEY)) || 0;

// build quick index by lowercased name
const nameIndex = {};
characters.forEach(ch => nameIndex[ch.name.toLowerCase()] = ch);

// pick random answer ensuring different from last
let lastAnswerKey = localStorage.getItem("gta_last_answer") || null;
function pickNewAnswer(){
  let choice;
  if(characters.length === 0) return null;
  do { choice = characters[Math.floor(Math.random()*characters.length)]; }
  while(choice.key === lastAnswerKey && characters.length > 1);
  lastAnswerKey = choice.key;
  localStorage.setItem("gta_last_answer", lastAnswerKey);
  return choice;
}
let answer = pickNewAnswer();

// state
let attempts = [];
const maxLives = 7;

// ui refs
const guessInput = document.getElementById("guessInput");
const suggestionsBox = document.getElementById("suggestions");
const guessBtn = document.getElementById("guessBtn");
const hintBtn = document.getElementById("hintBtn");
const attemptsArea = document.getElementById("attemptsArea");
const livesEl = document.getElementById("lives");
const streakEl = document.getElementById("streak");
const bestEl = document.getElementById("best");

// render stats
function renderStats(){
  livesEl.textContent = lives;
  streakEl.textContent = streak > 0 ? (streak + " üî•") : "0";
  bestEl.textContent = best;
}
renderStats();

// autocomplete
guessInput.addEventListener("input", onInput);
guessInput.addEventListener("keydown", e => { if(e.key === "Enter"){ e.preventDefault(); doGuess(); } });

function onInput(e){
  const q = (e.target.value || "").trim().toLowerCase();
  if(!q){ suggestionsBox.style.display="none"; return; }
  const matches = characters.filter(ch => ch.name.toLowerCase().includes(q)).slice(0,12);
  suggestionsBox.innerHTML = matches.map(m => `<div data-key="${m.key}">${m.name}</div>`).join("");
  suggestionsBox.style.display = matches.length ? "block":"none";
}
suggestionsBox.addEventListener("click", e => {
  const key = e.target.dataset.key; if(!key) return;
  const ch = characters.find(c=>c.key===key);
  if(ch){ guessInput.value = ch.name; suggestionsBox.style.display="none"; guessInput.focus(); }
});

// find by name (exact or includes)
function findCharacterByName(name){
  if(!name) return null;
  name = (name||"").trim().toLowerCase();
  let ch = characters.find(c => c.name.toLowerCase() === name);
  if(ch) return ch;
  ch = characters.find(c => c.name.toLowerCase().includes(name));
  return ch || null;
}

// compare columns: returns array of 6 {status,text}
function compareColumns(guessChar, ansChar){
  const res = [];

  // 1 game
  if(guessChar.game === ansChar.game) res.push({status:"green", text:guessChar.game});
  else if(guessChar.saga === ansChar.saga) res.push({status:"yellow", text:guessChar.game});
  else res.push({status:"red", text:guessChar.game});

  // 2 city
  const gCity = (guessChar.city||"").toLowerCase();
  const aCity = (ansChar.city||"").toLowerCase();
  if(gCity === aCity) res.push({status:"green", text:guessChar.city});
  else {
    const gTokens = gCity.split(/[\s\/,:]+/).filter(Boolean);
    const aTokens = aCity.split(/[\s\/,:]+/).filter(Boolean);
    const common = gTokens.some(t => aTokens.includes(t));
    if(common) res.push({status:"yellow", text:guessChar.city});
    else res.push({status:"red", text:guessChar.city});
  }

  // 3 affiliation
  if(guessChar.affiliation === ansChar.affiliation) res.push({status:"green", text:guessChar.affiliation});
  else if(guessChar.affiliationGroup === ansChar.affiliationGroup) res.push({status:"yellow", text:guessChar.affiliation});
  else res.push({status:"red", text:guessChar.affiliation});

  // 4 role
  if(guessChar.role === ansChar.role) res.push({status:"green", text:guessChar.role});
  else if(guessChar.roleGroup === ansChar.roleGroup) res.push({status:"yellow", text:guessChar.role});
  else res.push({status:"red", text:guessChar.role});

  // 5 year
  if(guessChar.year === ansChar.year) res.push({status:"green", text:String(guessChar.year)});
  else {
    const diff = Math.abs((guessChar.year||0) - (ansChar.year||0));
    const arrow = ((guessChar.year||0) < (ansChar.year||0)) ? "‚Üë" : "‚Üì";
    if(diff <= 3) res.push({status:"yellow", text: `${guessChar.year} ${arrow}`});
    else res.push({status:"red", text: `${guessChar.year} ${arrow}`});
  }

  // 6 saga
  if(guessChar.saga === ansChar.saga) res.push({status:"green", text:guessChar.saga});
  else if(guessChar.saga && ansChar.saga && guessChar.saga.split("-")[0] === ansChar.saga.split("-")[0]) res.push({status:"yellow", text:guessChar.saga});
  else res.push({status:"red", text:guessChar.saga});

  return res;
}

// render attempts: LAST attempt should appear ON TOP
function renderAttempts(){
  attemptsArea.innerHTML = "";
  [...attempts].reverse().forEach(at => {
    const comp = compareColumns(at.charObj, answer);
    const nameHeader = document.createElement("div");
    nameHeader.className = "name-header";
    nameHeader.textContent = at.charObj.name;
    attemptsArea.appendChild(nameHeader);

    const rowDiv = document.createElement("div");
    rowDiv.className = "row";
    comp.forEach(col => {
      const d = document.createElement("div");
      d.className = "cell";
      if(col.status === "green") d.classList.add("green");
      else if(col.status === "yellow") d.classList.add("yellow");
      else d.classList.add("red");
      d.innerHTML = `<div style="font-weight:700">${col.text}</div>`;
      rowDiv.appendChild(d);
    });
    attemptsArea.appendChild(rowDiv);
  });
}

// messages / overlay
function showMessageCentered(htmlMsg, showButton=false){
  document.querySelector(".overlay")?.remove();
  const overlay = document.createElement("div");
  overlay.className = "overlay";
  overlay.innerHTML = `<div class="overlay-box">${htmlMsg}${showButton ? `<div><button class="play-again" onclick="restartGame()">JUGAR OTRA VEZ</button></div>`:""}</div>`;
  document.body.appendChild(overlay);
}

// win/lose handlers update streak in storage
function updateStreakOnWin(){
  streak = (parseInt(localStorage.getItem(STREAK_KEY)) || 0) + 1;
  localStorage.setItem(STREAK_KEY, streak);
  if(streak > best){ best = streak; localStorage.setItem(BEST_KEY, best); }
  renderStats();
}
function resetStreakOnLose(){
  streak = 0;
  localStorage.setItem(STREAK_KEY, 0);
  renderStats();
}

function win(){
  updateStreakOnWin();
  showMessageCentered(`<div style="font-size:22px">‚úî ¬°GANASTE!</div><div style="margin-top:8px">El personaje era:<br><b>${answer.name}</b></div><div style="margin-top:8px">Racha actual: <b>${streak}</b> üî•</div>`, true);
}

function lose(){
  resetStreakOnLose();
  showMessageCentered(`<div style="font-size:22px">‚ùå PERDISTE</div><div style="margin-top:8px">El personaje era:<br><b>${answer.name}</b></div>`, true);
}

// restart
function restartGame(){
  document.querySelector(".overlay")?.remove();
  answer = pickNewAnswer();
  attempts = [];
  lives = maxLives;
  guessInput.value = "";
  renderAttempts();
  renderStats();
}

// main guess logic
function doGuess(){
  const val = guessInput.value.trim();
  if(!val){ alert("Escribe un personaje v√°lido."); return; }
  const ch = findCharacterByName(val);
  if(!ch){ alert("Personaje no encontrado. Usa el autocompletado o escribe un nombre exacto."); return; }
  if(attempts.some(a=>a.charObj.key === ch.key)){ alert("Ya intentaste con ese personaje."); return; }

  attempts.push({charObj: ch});
  renderAttempts();

  // only win when key matches exactly
  if(ch.key === answer.key){ win(); return; }
  else { lives = Math.max(0, lives - 1); renderStats(); if(lives <= 0){ lose(); return; } }

  guessInput.value = "";
  guessInput.focus();
}

// hint
hintBtn.addEventListener("click", () => {
  const p = answer.name[0];
  showMessageCentered(`Pista: Empieza con "<b>${p.toUpperCase()}</b>" ‚Äî Saga: <b>${answer.saga}</b>`, true);
});
guessBtn.addEventListener("click", doGuess);

// initialize render
renderAttempts();
renderStats();

// debug: lista disponible
console.log("Personajes disponibles: " + characters.length);
</script>

</body>
</html>
